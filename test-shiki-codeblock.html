<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiki CodeBlock Test</title>
    <script src="https://unpkg.com/react@19/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@19/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/shiki@3.9.2/dist/index.browser.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Dark mode styles */
        .dark {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .dark .container {
            background: #2a2a2a;
        }

        .dark .test-section {
            border-color: #404040;
        }

        .toggle-theme {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <button class="toggle-theme" onclick="toggleTheme()">Toggle Dark Mode</button>

    <div class="container">
        <h1>Shiki CodeBlock Component Test</h1>
        <p>Testing the new Shiki-based CodeBlock component that replaces react-syntax-highlighter</p>

        <div class="test-section">
            <div class="test-title">Test 1: JavaScript Code</div>
            <div id="test1"></div>
        </div>

        <div class="test-section">
            <div class="test-title">Test 2: Python Code</div>
            <div id="test2"></div>
        </div>

        <div class="test-section">
            <div class="test-title">Test 3: TypeScript Code</div>
            <div id="test3"></div>
        </div>
    </div>

    <script type="text/babel">
        // Mock utilities
        const cn = (...classes) => classes.filter(Boolean).join(' ');

        // Mock Button component
        const Button = ({ children, className, onClick, ...props }) => {
            return React.createElement('button', {
                className: `inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background hover:bg-accent hover:text-accent-foreground h-10 w-10 ${className || ''}`,
                onClick,
                style: {
                    backgroundColor: 'rgba(255,255,255,0.9)',
                    border: '1px solid #ccc',
                    cursor: 'pointer'
                },
                ...props
            }, children);
        };

        // Mock icons
        const CheckIcon = ({ size = 16 }) => React.createElement('svg', {
            width: size,
            height: size,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2
        }, React.createElement('polyline', { points: '20,6 9,17 4,12' }));

        const CopyIcon = ({ size = 16 }) => React.createElement('svg', {
            width: size,
            height: size,
            viewBox: '0 0 24 24',
            fill: 'none',
            stroke: 'currentColor',
            strokeWidth: 2
        }, React.createElement('rect', { x: 9, y: 9, width: 13, height: 13, rx: 2, ry: 2 }),
            React.createElement('path', { d: 'M5,15H4a2,2,0,0,1-2-2V4A2,2,0,0,1,4,2H15a2,2,0,0,1,2,2V5' }));

        // Test status component
        const TestStatus = ({ status, message }) => {
            return React.createElement('div', {
                className: `status ${status}`
            }, message);
        };

        // Context for CodeBlock
        const CodeBlockContext = React.createContext({ code: "" });

        // Shiki-based CodeBlock component (simplified for testing)
        const ShikiCodeBlock = ({ code, language, showLineNumbers = false, children }) => {
            const [lightHtml, setLightHtml] = React.useState("");
            const [darkHtml, setDarkHtml] = React.useState("");
            const [isLoading, setIsLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            React.useEffect(() => {
                const highlightCode = async () => {
                    try {
                        setIsLoading(true);
                        setError(null);

                        // Check if Shiki is available
                        if (typeof window.shiki === 'undefined') {
                            throw new Error('Shiki not loaded');
                        }

                        // Create highlighter
                        const highlighter = await window.shiki.createHighlighter({
                            themes: ['github-light', 'github-dark'],
                            langs: [language, 'javascript', 'typescript', 'python']
                        });

                        // Generate HTML for light theme
                        const lightResult = highlighter.codeToHtml(code, {
                            lang: language,
                            theme: 'github-light'
                        });

                        // Generate HTML for dark theme
                        const darkResult = highlighter.codeToHtml(code, {
                            lang: language,
                            theme: 'github-dark'
                        });

                        setLightHtml(lightResult);
                        setDarkHtml(darkResult);
                    } catch (error) {
                        console.error('Failed to highlight code:', error);
                        setError(error.message);
                        // Fallback to plain text
                        const fallback = `<pre style="margin: 0; padding: 16px; font-family: monospace; font-size: 14px; background: #f8f9fa; border-radius: 6px;"><code>${code}</code></pre>`;
                        setLightHtml(fallback);
                        setDarkHtml(fallback);
                    } finally {
                        setIsLoading(false);
                    }
                };

                highlightCode();
            }, [code, language, showLineNumbers]);

            if (isLoading) {
                return React.createElement('div', {
                    style: {
                        border: '1px solid #e0e0e0',
                        borderRadius: '6px',
                        padding: '16px',
                        backgroundColor: '#f8f9fa',
                        position: 'relative'
                    }
                },
                    React.createElement('div', {
                        style: { fontFamily: 'monospace', fontSize: '14px', color: '#666' }
                    }, 'Loading Shiki syntax highlighting...'),
                    children && React.createElement('div', {
                        style: { position: 'absolute', top: '8px', right: '8px' }
                    }, children));
            }

            if (error) {
                return React.createElement('div', {
                    style: {
                        border: '1px solid #f5c6cb',
                        borderRadius: '6px',
                        padding: '16px',
                        backgroundColor: '#f8d7da',
                        position: 'relative'
                    }
                },
                    React.createElement('div', {
                        style: { fontFamily: 'monospace', fontSize: '14px', color: '#721c24' }
                    }, `Error: ${error}. Falling back to plain text.`),
                    React.createElement('pre', {
                        style: {
                            margin: '10px 0 0 0',
                            padding: '10px',
                            fontFamily: 'monospace',
                            fontSize: '14px',
                            backgroundColor: 'rgba(255,255,255,0.5)',
                            borderRadius: '4px'
                        }
                    }, React.createElement('code', null, code)),
                    children && React.createElement('div', {
                        style: { position: 'absolute', top: '8px', right: '8px' }
                    }, children));
            }

            return React.createElement(CodeBlockContext.Provider, { value: { code } },
                React.createElement('div', {
                    style: {
                        border: '1px solid #e0e0e0',
                        borderRadius: '6px',
                        backgroundColor: '#f8f9fa',
                        position: 'relative',
                        overflow: 'hidden'
                    }
                },
                    React.createElement('div', { style: { position: 'relative' } },
                        // Light mode
                        React.createElement('div', {
                            className: 'dark:hidden',
                            style: { display: document.body.classList.contains('dark') ? 'none' : 'block' },
                            dangerouslySetInnerHTML: { __html: lightHtml }
                        }),
                        // Dark mode
                        React.createElement('div', {
                            className: 'hidden dark:block',
                            style: { display: document.body.classList.contains('dark') ? 'block' : 'none' },
                            dangerouslySetInnerHTML: { __html: darkHtml }
                        }),
                        children && React.createElement('div', {
                            style: { position: 'absolute', top: '8px', right: '8px', display: 'flex', gap: '8px' }
                        }, children)
                    ))
            );
        };

        // Copy button component
        const CopyButton = ({ code }) => {
            const [isCopied, setIsCopied] = React.useState(false);

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(code);
                    setIsCopied(true);
                    setTimeout(() => setIsCopied(false), 2000);
                } catch (error) {
                    console.error('Failed to copy:', error);
                }
            };

            return React.createElement(Button, {
                onClick: handleCopy
            }, React.createElement(isCopied ? CheckIcon : CopyIcon, { size: 14 }));
        };

        // Test cases
        const jsCode = `function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

console.log(fibonacci(10));`;

        const pythonCode = `def quicksort(arr):
    if len(arr) <= 1:
        return arr
    
    pivot = arr[len(arr) // 2]
    left = [x for x in arr if x < pivot]
    middle = [x for x in arr if x == pivot]
    right = [x for x in arr if x > pivot]
    
    return quicksort(left) + middle + quicksort(right)

print(quicksort([3, 6, 8, 10, 1, 2, 1]))`;

        const tsCode = `interface User {
  id: number;
  name: string;
  email: string;
}

class UserService {
  private users: User[] = [];

  addUser(user: User): void {
    this.users.push(user);
  }

  getUserById(id: number): User | undefined {
    return this.users.find(user => user.id === id);
  }
}`;

        // Render tests
        ReactDOM.render(
            React.createElement(React.Fragment, null,
                React.createElement(TestStatus, { status: 'success', message: 'Testing Shiki-based CodeBlock (replacement for react-syntax-highlighter)' }),
                React.createElement(ShikiCodeBlock, {
                    code: jsCode,
                    language: 'javascript'
                }, React.createElement(CopyButton, { code: jsCode }))
            ),
            document.getElementById('test1')
        );

        ReactDOM.render(
            React.createElement(React.Fragment, null,
                React.createElement(TestStatus, { status: 'success', message: 'Python code test' }),
                React.createElement(ShikiCodeBlock, {
                    code: pythonCode,
                    language: 'python',
                    showLineNumbers: true
                }, React.createElement(CopyButton, { code: pythonCode }))
            ),
            document.getElementById('test2')
        );

        ReactDOM.render(
            React.createElement(React.Fragment, null,
                React.createElement(TestStatus, { status: 'success', message: 'TypeScript code test' }),
                React.createElement(ShikiCodeBlock, {
                    code: tsCode,
                    language: 'typescript'
                }, React.createElement(CopyButton, { code: tsCode }))
            ),
            document.getElementById('test3')
        );

        // Theme toggle functionality
        window.toggleTheme = function () {
            document.body.classList.toggle('dark');
            // Force re-render by updating a dummy state
            const event = new CustomEvent('themechange');
            window.dispatchEvent(event);
        };
    </script>
</body>

</html>